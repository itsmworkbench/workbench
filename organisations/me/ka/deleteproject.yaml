variables:
  - environment
  - projectId
  - system
capabilities:
  - Email
  - LDAP
  - ReviewTicket
  - SQL
actions:
  CheckTicket:
    SelectKnowledgeArticle:
      by: SelectKnowledgeArticle
      recordInCapability: false
    ReviewTicket:
      by: ReviewTicket
    RequestMoreData:
      by: Email
      to: issuer.email
      optional: true
      highlyVariant: true
    checkProblemExists:
      by: SQL
      sql: select * from projects where project_id = '${projectId}'
      env: ${environment}
    checkUser:
      safe: true
      by: LDAP
      who: philip.rice@hcl.com
    checkApprover:
      safe: true
      by: LDAP
      who: the.boss@example.com
  Approval:
    requestApproval:
      waitingFor: []
      by: Email
      to: phil.rice@validoc.org
      subject: >-
        Request for Approval: Deletion of Project ${projectId} in ${system}
        Acceptance Environment
      email: >-
        I am writing to seek approval for the deletion of project ${projectId}
        in the ${system} acceptance environment. This project was created by
        mistake and needs to be removed promptly to avoid any confusion or
        issues.


        Your prompt approval to proceed with the deletion of project
        ${projectId} would be greatly appreciated. Please let me know if you
        require any further information or clarification regarding this matter.


        Thank you for your attention to this request.
    receiveApproval:
      by: ReceiveEmail
      from: approval.to
      waitingFor:
        - requestApproval
  Resolve:
    resolveTheIssue:
      waitingFor:
        - checkIssueStillExists
      by: SQL
      sql: delete from projects where project_id='${projectId}'
      env: ${environment}
    checkIssueStillExists:
      by: SQL
      sql: select * from projects where project_id = '${projectId}'
      env: ${environment}
  Close:
    requestClosure:
      waitingFor: []
      by: Email
      to: philip.rice@hcl.com
      subject: 'Completion of Project ${projectId}: Request for Closure'
      email: >
        I am writing to inform you that the project ${projectId}, which was
        mistakenly created in the ${system} acceptance environment, has been
        successfully deleted as per your request. 


        Please proceed with closing the ticket associated with this project. 


        Thank you for your attention to this matter.


        Best regards,
    agreeClosure:
      by: ReceiveEmail
      from: issuer.email
      waitingFor:
        - requestClosure
    closed:
      by: Ticket
      waitingFor:
        - agreeClosure
  Review:
    createKnowledgeArticle:
      by: CreateKnowledgeArticle
      recordInCapability: false
      optional: true
