variables:
  - correctedPrice
  - currentPrice
  - environment
  - itemCode
  - itemName
capabilities:
  - Email
  - LDAP
  - ReviewTicket
  - SQL
actions:
  CheckTicket:
    SelectKnowledgeArticle:
      by: SelectKnowledgeArticle
      recordInCapability: false
    ReviewTicket:
      by: ReviewTicket

    RequestMoreData:
      by: Email
      to: issuer.email
      optional: true
      highlyVariant: true
    checkProblemExists:
      by: SQL
      sql: Select * from projects where project_id = '${itemCode}'
    checkUser:
      safe: true
      by: LDAP
      who: a.customer@example.com
    checkApprover:
      safe: true
      by: LDAP
      who: approval.to
  Approval:
    requestApproval:
      waitingFor: []
      by: Email
      to: approval.to
      subject: >-
        Ticket Price_234 Please approve price change for ${itemName} item code
        ${itemCode} to ${correctedPrice}
      email: >-
        I hope this message finds you well. 


        I am writing to seek your approval for a task that requires immediate
        attention. In the EPX system, we have identified an issue with the
        pricing of the ${itemName} (item code ${itemCode}). Currently, the
        price is set at ${currentPrice}, which is incorrect. After thorough
        review, we have confirmed that the correct price should be
        ${correctedPrice}. 


        To rectify this error, we need to update the price of the
        ${itemName} in the EPX ${environment} environment. This adjustment
        is crucial to ensure accurate pricing and avoid any discrepancies for
        our customers.


        I have prepared a detailed plan to implement this change efficiently
        without causing any disruptions to our operations. Your approval for
        this task will allow us to proceed with the necessary adjustments
        promptly.


        Thank you for considering this request. Please let me know if you
        require any further information or clarification regarding this matter.


        Looking forward to your prompt response.


        Best regards,


        [Your Name]
    receiveApproval:
      by: ReceiveEmail
      from: approval.to
      waitingFor:
        - requestApproval
  Resolve:
    resolveTheIssue:
      waitingFor:
        - checkIssueStillExists
      by: SQL
      sql: delete from projects where project_id = '${itemCode}'
    checkIssueStillExists:
      by: SQL
      sql: Select * from projects where project_id = '${itemCode}'
  Close:
    requestClosure:
      waitingFor: []
      by: Email
      to: issuer.email
      subject: ''
      email: >-
        I hope this email finds you well. 


        I am writing to inform you that the task regarding the price update for
        the ${itemName} (item code ${itemCode}) in the EPX ${environment}
        has been successfully completed. The incorrect price of ${currentPrice}
        has been rectified and updated to the correct price of ${correctedPrice}
        as per the instructions provided in the ticket.


        I have thoroughly reviewed the changes to ensure accuracy, and
        everything is now in order. Therefore, I kindly request that this task
        be marked as completed and the ticket be closed.


        Thank you for entrusting me with this task. Please let me know if there
        are any further actions required from my end.


        Best regards,


        [Your Name]
    agreeClosure:
      by: ReceiveEmail
      from: issuer.email
      waitingFor:
        - requestClosure
    closed:
      by: Ticket
      waitingFor:
        - agreeClosure
  Review:
    createKnowledgeArticle:
      by: CreateKnowledgeArticle
      recordInCapability: false
      optional: true
