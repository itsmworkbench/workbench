variables:
  - correctedPrice
  - currentPrice
  - issuer
  - itemId
  - itemName
  - ticketName
capabilities:
  - Email
  - ReceiveEmail
  - ReviewTicket
  - SQL
actions:
  CheckTicket:
    SelectKnowledgeArticle:
      by: SelectKnowledgeArticle
      recordInCapability: false
    ReviewTicket:
      by: ReviewTicket
    RequestMoreData:
      by: Email
      to: issuer.email
      optional: true
      highlyVariant: true
      withMissingData: true
    checkProblemExists:
      by: SQL
      sql: select * from products where product_id = '${itemId}'
      env: oracle
  Approval:
    requestApproval:
      waitingFor: []
      by: Email
      to: philip.rice@hcl.com
      subject: >-
        Request for Approval: Price Correction for ${itemName} in EPX
        [${ticketName}]
      email: >-
        I am writing to request approval for a price correction task in the EPX
        system. 


        In the EPX, the ${itemName} with item code ${itemId} currently has an
        incorrect price listed as ${currentPrice}. Upon review, it has been
        identified that the correct price for this item should be
        ${correctedPrice}. 


        I recommend correcting the price to ensure accuracy and consistency in
        our system. Your approval for this task would allow us to proceed with
        updating the price to the correct amount. 


        Thank you for considering this request. Please let me know if you
        require any further information or clarification regarding this task.
    receiveApproval:
      by: ReceiveEmail
      from: philip.rice@hcl.com
      waitingFor:
        - requestApproval
  Resolve:
    checkIssueStillExists:
      by: SQL
      sql: select * from products where product_id = '${itemId}'
      env: oracle
    resolveTheIssue:
      waitingFor:
        - checkIssueStillExists
      by: SQL
      sql: >-
        update products set price = ${correctedPrice} where product_id =
        '${itemId}'
      env: oracle
    checkProblemResolved:
      by: SQL
      sql: select * from products where product_id = '${itemId}'
      env: oracle
  Close:
    requestClosure:
      waitingFor: []
      by: Email
      to: ${issuer}
      subject: >-
        Task Completion: Incorrect Price Correction for ${itemName}
        ${ticketName}
      email: >-
        I am writing to inform you that the task regarding the correction of the
        price for the ${itemName} (item code ${itemId}) in the EPX has been
        successfully completed. The price has been updated from ${currentPrice}
        to the correct amount of ${correctedPrice} as requested.


        Kindly review the changes and confirm if everything is in order. If
        there are any further adjustments needed or if you require any
        additional information, please let me know so that I can address it
        promptly.


        Thank you for your attention to this matter, and I kindly request the
        closure of the ticket related to this task.
    agreeClosure:
      by: ReceiveEmail
      from: phil.rice@validoc.org
      waitingFor:
        - requestClosure
    closed:
      by: Ticket
      waitingFor:
        - agreeClosure
  Review:
    createKnowledgeArticle:
      by: CreateKnowledgeArticle
      recordInCapability: false
      optional: true
