variables:
  - Environment
  - System
  - currentColor
  - desiredColor
  - itemId
capabilities:
  - Email
  - ReviewTicket
  - SQL
actions:
  CheckTicket:
    SelectKnowledgeArticle:
      by: SelectKnowledgeArticle
      recordInCapability: false
    ReviewTicket:
      by: ReviewTicket
    RequestMoreData:
      by: Email
      to: issuer.email
      optional: true
      highlyVariant: true
    checkProblemExists:
      by: SQL
      sql: select * from products where item_id = '${itemId}'
  Approval:
    requestApproval:
      waitingFor: []
      by: Email
      to: theboss@example.com
      subject: >-
        Request for Approval: Change Button Colour in ${System} Production
        Environment
      email: >
        Issue:

        * in the ${System} ${Environment} environment the colour of the button
        is wrong. It should be ${desiredColor} and is ${currentColor}.
          * The button is button id ${itemId}

        Action requested:

        * Please change the colour of the button to ${desiredColor}


        Thank you for your attention to this matter.
    receiveApproval:
      by: ReceiveEmail
      from: approval.to
      waitingFor:
        - requestApproval
  Resolve:
    resolveTheIssue:
      waitingFor:
        - checkIssueStillExists
      by: SQL
      sql: >-
        update products set color ='${desiredColor}' where item_id =
        '${itemId}' 
    checkIssueStillExists:
      by: SQL
      sql: select * from products where item_id = '${itemId}'
  Close:
    requestClosure:
      waitingFor: []
      by: Email
      to: a.customer@example.com
      subject: 'Task Completion: Change Button Color in ${System} Production Environment'
      email: >+
        I am writing to inform you that the requested change has been completed
        successfully. In the ${System} ${Environment} environment, the colour of
        the button with ID "${itemId}" has been changed from ${currentColor} to
        ${desiredColor}, as per your instructions.


        Please review the environment to confirm that the button now appears in
        the correct color. If everything looks satisfactory, could you kindly
        close the ticket related to this task?


        Thank you for your attention to this matter.

    agreeClosure:
      by: ReceiveEmail
      from: issuer.email
      waitingFor:
        - requestClosure
    closed:
      by: Ticket
      waitingFor:
        - agreeClosure
  Review:
    createKnowledgeArticle:
      by: CreateKnowledgeArticle
      recordInCapability: false
      optional: true
